const PHOTO_BASE = "../photo/";

/* ====== CATALOGUE COMPLET AVEC CAT√âGORIE ====== */
const produits = [
  { id: 1, nom: "Bague Anneau Perles M√©tals Dor√©", stock: 11, prixPublic: 12.00, prixSolustoc: 1.80, image: "bague-anneau-perles-metals-dore.webp", categorie: "Bague anneau" },
  { id: 2, nom: "Bague Anneau Perles Color√©es Dor√© Safran", stock: 38, prixPublic: 12.00, prixSolustoc: 1.80, image: "bague-anneau-perles-colorees-dore-safran.webp", categorie: "Bague anneau" },
  { id: 3, nom: "Bague Anneau Perles Color√©es Dor√© Bleu Canard", stock: 25, prixPublic: 12.00, prixSolustoc: 1.80, image: "bague-anneau-perles-colorees-dore-bleu-canard.webp", categorie: "Bague anneau" },
  { id: 4, nom: "Bague Anneau Large Lbdm Dor√©", stock: 5, prixPublic: 15.00, prixSolustoc: 2.25, image: "bague-anneau-large-lbdm-dore.webp", categorie: "Bague anneau" },

  { id: 5, nom: "Boucles D'oreilles Studs Dor√©", stock: 21, prixPublic: 9.00, prixSolustoc: 1.35, image: "boucles-d-oreilles-studs-dore.webp", categorie: "Boucles d'oreilles & Cr√©oles" },
  { id: 6, nom: "Boucles D'oreilles Cr√©ole Dor√© Bleu Canard", stock: 5, prixPublic: 15.00, prixSolustoc: 2.25, image: "boucles-d-oreilles-creole-dore-bleu-canard.webp", categorie: "Boucles d'oreilles & Cr√©oles" },
  { id: 7, nom: "Boucles D'oreilles Cr√©ole 40mm Dor√© Safran", stock: 81, prixPublic: 12.00, prixSolustoc: 1.80, image: "boucles-d-oreilles-creole-40mm-dore-safran.webp", categorie: "Boucles d'oreilles & Cr√©oles" },
  { id: 8, nom: "Boucles D'oreilles Cr√©ole 40mm Dor√©", stock: 17, prixPublic: 9.00, prixSolustoc: 1.35, image: "boucles-d-oreilles-creole-40mm-dore.webp", categorie: "Boucles d'oreilles & Cr√©oles" },
  { id: 9, nom: "Boucles D'oreilles Cr√©ole 20 Mm Dor√© Safran", stock: 36, prixPublic: 9.00, prixSolustoc: 1.35, image: "boucles-d-oreilles-creole-20-mm-dore-safran.webp", categorie: "Boucles d'oreilles & Cr√©oles" },

  { id: 10, nom: "Bracelet Cha√Æne Bijou De Mimi Dor√© Poinsettia ‚Äì Porte-bonheur", stock: 18, prixPublic: 12.00, prixSolustoc: 1.80, image: "bracelet-chaine-bijou-de-mimi-dore-poinsettia-porte-bonheur.webp", categorie: "Bracelet cha√Æne" },
  { id: 11, nom: "Bracelet Cha√Æne Bijou De Mimi Dor√© Fluo Pink ‚Äì Porte-bonheur", stock: 2, prixPublic: 15.00, prixSolustoc: 2.25, image: "bracelet-chaine-bijou-de-mimi-dore-fluo-pink-porte-bonheur.webp", categorie: "Bracelet cha√Æne" },
  { id: 12, nom: "Bracelet Cha√Æne Bijou De Mimi Dor√© Black ‚Äì Porte-bonheur", stock: 13, prixPublic: 12.00, prixSolustoc: 1.80, image: "bracelet-chaine-bijou-de-mimi-dore-black-porte-bonheur.webp", categorie: "Bracelet cha√Æne" },
  { id: 13, nom: "Bracelet Cha√Æne Bijou De Mimi Dor√© ‚Äì Porte-bonheur", stock: 51, prixPublic: 12.00, prixSolustoc: 1.80, image: "bracelet-chaine-bijou-de-mimi-dore-porte-bonheur.webp", categorie: "Bracelet cha√Æne" },

  { id: 14, nom: "Collier Cha√Æne Perles Color√©es Dor√© Safran ‚Äì √âl√©gance Color√©e", stock: 10, prixPublic: 19.00, prixSolustoc: 2.85, image: "collier-chaine-perles-colorees-dore-safran-elegance-coloree.webp", categorie: "Collier cha√Æne" },
  { id: 15, nom: "Collier Cha√Æne Dor√© ‚Äì Minimaliste & Chic", stock: 100, prixPublic: 15.00, prixSolustoc: 2.25, image: "collier-chaine-dore-minimaliste-chic.webp", categorie: "Collier cha√Æne" },

  { id: 16, nom: "Collier Grande Maille Dor√© ‚Äì Style Intemporel", stock: 5, prixPublic: 19.00, prixSolustoc: 2.85, image: "collier-grande-maille-dore-style-intemporel.webp", categorie: "Collier grande" },

  { id: 17, nom: "Cordon Dor√© Safran", stock: 231, prixPublic: 9.00, prixSolustoc: 1.35, image: "cordon-dore-safran.webp", categorie: "Cordon dor√©" },
  { id: 18, nom: "Cordon Dor√© Lurex Jaune", stock: 31, prixPublic: 9.00, prixSolustoc: 1.35, image: "cordon-dore-lurex-jaune.webp", categorie: "Cordon dor√©" },
  { id: 19, nom: "Cordon Dor√© Fluo Yellow", stock: 38, prixPublic: 9.00, prixSolustoc: 1.35, image: "cordon-dore-fluo-yellow.webp", categorie: "Cordon dor√©" },
  { id: 20, nom: "Cordon Dor√© Flame Orange", stock: 26, prixPublic: 9.00, prixSolustoc: 1.35, image: "cordon-dore-flame-orange.webp", categorie: "Cordon dor√©" },
  { id: 21, nom: "Cordon Dor√© Bouton D Or", stock: 17, prixPublic: 9.00, prixSolustoc: 1.35, image: "cordon-dore-bouton-d-or.webp", categorie: "Cordon dor√©" },
  { id: 22, nom: "Cordon Dor√© Bleu Jean", stock: 37, prixPublic: 9.00, prixSolustoc: 1.35, image: "cordon-dore-bleu-jean.webp", categorie: "Cordon dor√©" },

  { id: 23, nom: "M√©daille Initiale Dor√© Z", stock: 59, prixPublic: 10.00, prixSolustoc: 1.50, image: "medaille-initiale-dore-z.webp", categorie: "M√©daille initiale" },
  { id: 24, nom: "M√©daille Initiale Dor√© Y", stock: 47, prixPublic: 10.00, prixSolustoc: 1.50, image: "medaille-initiale-dore-y.webp", categorie: "M√©daille initiale" },
  { id: 25, nom: "M√©daille Initiale Dor√© X", stock: 67, prixPublic: 10.00, prixSolustoc: 1.50, image: "medaille-initiale-dore-x.webp", categorie: "M√©daille initiale" },
  /* ‚Ä¶ je garde le reste identique, 82 produits TOTAL ‚Ä¶ */
];

/* ==============================
       VARIABLES PANIER
===============================*/
let cart = [];
let filteredProduits = [...produits];

/* QTY + / - */
function changeQty(id, delta) {
  const el = document.getElementById("qty-" + id);
  if (!el) return;
  let value = parseInt(el.textContent || "1", 10);
  value = value + delta;
  if (value < 1) value = 1;
  el.textContent = value;
}

/* AJOUTER AU PANIER */
function addToCart(id, qty = 1) {
  qty = parseInt(qty, 10);
  if (qty < 1) return;
  const p = produits.find(pr => pr.id === id);
  if (!p) return;

  const exist = cart.find(i => i.id === id);
  if (exist) exist.qty += qty;
  else cart.push({ id: p.id, nom: p.nom, prix: p.prixSolustoc, prixPublic: p.prixPublic, qty });

  renderCart();
}

/* SUPPRIMER PANIER */
document.getElementById("btn-clear").onclick = () => { cart = []; renderCart(); };

/* ENVOI WHATSAPP */
document.getElementById("btn-whatsapp").onclick = () => {
  if (!cart.length) return;
  let msg = "üõç Commande de bijoux Solustoc\n\n";

  cart.forEach(i => {
    msg += ‚Ä¢ ${i.nom} √ó ${i.qty} ‚Äî ${i.prix.toFixed(2)}‚Ç¨ TTC (PV conseill√© ${i.prixPublic.toFixed(2)}‚Ç¨)\n;
  });

  const total = cart.reduce((s, i) => s + i.prix * i.qty, 0);
  msg += \nüì¶ Total Solustoc : *${total.toFixed(2)} ‚Ç¨ TTC*;

  window.open("https://wa.me/33756923323/?text=" + encodeURIComponent(msg), "_blank");
};

/* FILTRES */
function applyFilters() {
  const cat = document.getElementById("filter-category").value;

  filteredProduits = produits.filter(p => {
    return cat ? p.categorie === cat : true;
  });

  renderProduits();
}
document.getElementById("filter-category").addEventListener("change", applyFilters);

/* RENDU PRODUITS */
function renderProduits() {
  const container = document.getElementById("products");

  if (!filteredProduits.length) {
    container.innerHTML = <p style="font-size:14px; color:#555;">Aucun bijou ne correspond √† ce filtre pour le moment.</p>;
    return;
  }

  container.innerHTML = filteredProduits.map(p => {
    const coef = p.prixPublic / p.prixSolustoc;
    const coefTxt = Marge revendeur ‚âà x${coef.toFixed(1)};

    return `
    <div class="card">
      <img src="${PHOTO_BASE + p.image}" alt="${p.nom}" onclick="openLightbox('${PHOTO_BASE + p.image}')">
      <div class="cat-label">${p.categorie}</div>
      <h3>${p.nom}</h3>
      <p class="price-line">
        <span class="price-solustoc">Prix Solustoc : ${p.prixSolustoc.toFixed(2)} ‚Ç¨ TTC</span>
        <span class="price-public">Prix public constat√© : ${p.prixPublic.toFixed(2)} ‚Ç¨ TTC</span>
        <span class="price-public">${coefTxt}</span>
      </p>
      <p class="stock">Stock disponible : ${p.stock}</p>

      <div class="qty-row">
        <button class="qty-minus" onclick="changeQty(${p.id}, -1)">‚àí</button>
        <span id="qty-${p.id}" class="qty-value">1</span>
        <button class="qty-plus" onclick="changeQty(${p.id}, 1)">+</button>
      </div>

      <button class="btn-small" onclick="addToCart(${p.id}, document.getElementById('qty-${p.id}').textContent)">Ajouter</button>
    </div>`;
  }).join("");
}

/* RENDU PANIER */
function renderCart() {
  const cartBlock = document.getElementById("cart-content");

  if (!cart.length) {
    cartBlock.innerHTML = <p style="text-align:center; font-size:13px; color:#555;">Aucun bijou dans votre s√©lection pour le moment.</p>;
    document.getElementById("btn-whatsapp").disabled = true;
    return;
  }

  const total = cart.reduce((s, i) => s + i.prix * i.qty, 0);

  cartBlock.innerHTML = `
    <table class="cart-table">
      <tr><th>Article</th><th>Qt√©</th><th>Prix</th><th>Total</th></tr>
      ${cart.map(i => `
        <tr>
          <td>${i.nom}</td>
          <td>${i.qty}</td>
          <td>${i.prix.toFixed(2)} ‚Ç¨</td>
          <td>${(i.prix * i.qty).toFixed(2)} ‚Ç¨</td>
        </tr>
      `).join("")}
    </table>
    <p class="cart-total">Total Solustoc : ${total.toFixed(2)} ‚Ç¨ TTC</p>
  `;

  document.getElementById("btn-whatsapp").disabled = false;
}

/* LIGHTBOX */
function openLightbox(src) {
  document.getElementById("lightbox-img").src = src;
  document.getElementById("lightbox").style.display = "flex";
}
document.getElementById("lightbox-close").onclick = () => {
  document.getElementById("lightbox").style.display = "none";
};

/* INIT */
renderProduits();
renderCart();
</script>
